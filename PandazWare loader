--[[
    PANDAZWARE MOBILE LOADER (ULTIMATE EDITION)
    
    How to use:
    1. Upload this code to GitHub (create a new file, e.g. "loader.lua").
    2. Click "Raw" on your GitHub file.
    3. Copy the URL and use: loadstring(game:HttpGet("YOUR_RAW_LINK"))()
]]

local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local TextService = game:GetService("TextService")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local CoreGui = game:GetService("CoreGui")

-- ========================================== --
--       1. CUSTOM NOTIFICATION LIBRARY       --
-- ========================================== --
local NotificationLibrary = (function()
    local lib = {}
    
    -- Safe Parent Logic (Supports gethui for modern executors)
    local function getSafeParent()
        if gethui then
            return gethui()
        elseif CoreGui then
            return CoreGui
        else
            return Players.LocalPlayer:WaitForChild("PlayerGui")
        end
    end

    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "PandazNotifications"
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    ScreenGui.Parent = getSafeParent()

    local Container = Instance.new("Frame")
    Container.Name = "NotificationContainer"
    Container.Parent = ScreenGui
    Container.BackgroundTransparency = 1
    Container.Position = UDim2.new(0.5, -125, 0.05, 0) 
    Container.Size = UDim2.new(0, 250, 0.8, 0) 
    Container.ClipsDescendants = false

    local UIListLayout = Instance.new("UIListLayout")
    UIListLayout.Parent = Container
    UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
    UIListLayout.Padding = UDim.new(0, 8)
    UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
    UIListLayout.VerticalAlignment = Enum.VerticalAlignment.Top

    function lib.Notify(title, text, duration)
        title = title or "System"
        text = text or "..."
        duration = duration or 3

        local Frame = Instance.new("Frame")
        Frame.Name = "NotifFrame"
        Frame.Parent = Container
        Frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25) 
        Frame.BorderSizePixel = 0
        Frame.Size = UDim2.new(1, 0, 0, 0) 
        Frame.BackgroundTransparency = 1
        Frame.ClipsDescendants = true

        local UICorner = Instance.new("UICorner")
        UICorner.CornerRadius = UDim.new(0, 10)
        UICorner.Parent = Frame

        local UIStroke = Instance.new("UIStroke")
        UIStroke.Parent = Frame
        UIStroke.Color = Color3.fromRGB(60, 60, 60)
        UIStroke.Thickness = 1.5
        UIStroke.Transparency = 1

        local TitleLabel = Instance.new("TextLabel")
        TitleLabel.Name = "Title"
        TitleLabel.Parent = Frame
        TitleLabel.BackgroundTransparency = 1
        TitleLabel.Position = UDim2.new(0.05, 0, 0, 5)
        TitleLabel.Size = UDim2.new(0.9, 0, 0, 20)
        TitleLabel.Font = Enum.Font.GothamBold
        TitleLabel.Text = title
        TitleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
        TitleLabel.TextSize = 14
        TitleLabel.TextXAlignment = Enum.TextXAlignment.Left
        TitleLabel.TextTransparency = 1

        local DescLabel = Instance.new("TextLabel")
        DescLabel.Name = "Description"
        DescLabel.Parent = Frame
        DescLabel.BackgroundTransparency = 1
        DescLabel.Position = UDim2.new(0.05, 0, 0, 25)
        DescLabel.Size = UDim2.new(0.9, 0, 1, -30)
        DescLabel.Font = Enum.Font.Gotham
        DescLabel.Text = text
        DescLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
        DescLabel.TextSize = 12
        DescLabel.TextWrapped = true
        DescLabel.TextXAlignment = Enum.TextXAlignment.Left
        DescLabel.TextYAlignment = Enum.TextYAlignment.Top
        DescLabel.TextTransparency = 1

        local textBounds = TextService:GetTextSize(text, 12, Enum.Font.Gotham, Vector2.new(225, 1000))
        local targetHeight = math.clamp(textBounds.Y + 35, 50, 150)

        local openInfo = TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
        
        TweenService:Create(Frame, openInfo, {
            Size = UDim2.new(1, 0, 0, targetHeight),
            BackgroundTransparency = 0.1
        }):Play()
        
        TweenService:Create(UIStroke, openInfo, {Transparency = 0}):Play()
        
        task.spawn(function()
            task.wait(0.1)
            TweenService:Create(TitleLabel, openInfo, {TextTransparency = 0}):Play()
            TweenService:Create(DescLabel, openInfo, {TextTransparency = 0}):Play()
        end)

        local ProgressBar = Instance.new("Frame")
        ProgressBar.Parent = Frame
        ProgressBar.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        ProgressBar.BorderSizePixel = 0
        ProgressBar.Position = UDim2.new(0, 0, 1, -2)
        ProgressBar.Size = UDim2.new(0, 0, 0, 2)
        
        TweenService:Create(ProgressBar, TweenInfo.new(duration, Enum.EasingStyle.Linear), {Size = UDim2.new(1,0,0,2)}):Play()

        task.delay(duration, function()
            if not Frame then return end
            local closeInfo = TweenInfo.new(0.4, Enum.EasingStyle.Quint, Enum.EasingDirection.In)
            
            TweenService:Create(TitleLabel, closeInfo, {TextTransparency = 1}):Play()
            TweenService:Create(DescLabel, closeInfo, {TextTransparency = 1}):Play()
            TweenService:Create(UIStroke, closeInfo, {Transparency = 1}):Play()
            
            local closeTween = TweenService:Create(Frame, closeInfo, {
                Size = UDim2.new(1, 0, 0, 0),
                BackgroundTransparency = 1
            })
            closeTween:Play()
            
            closeTween.Completed:Connect(function()
                Frame:Destroy()
            end)
        end)
    end
    return lib
end)()

NotificationLibrary.Notify("PandazWare", "Loader initializing...", 2)

-- ========================================== --
--             2. MOBILE GUI SETUP            --
-- ========================================== --

local PandazGUI = Instance.new("ScreenGui")
PandazGUI.Name = "PandazWare_Loader"
if gethui then
    PandazGUI.Parent = gethui()
else
    PandazGUI.Parent = CoreGui
end
PandazGUI.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
PandazGUI.IgnoreGuiInset = true

-- Toggle Button (Small PZ Icon)
local ToggleBtn = Instance.new("TextButton")
ToggleBtn.Name = "ToggleBtn"
ToggleBtn.Parent = PandazGUI
ToggleBtn.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
ToggleBtn.BorderSizePixel = 0
ToggleBtn.Position = UDim2.new(0.02, 0, 0.2, 0)
ToggleBtn.Size = UDim2.new(0, 45, 0, 45)
ToggleBtn.Font = Enum.Font.FredokaOne
ToggleBtn.Text = "PZ"
ToggleBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
ToggleBtn.TextSize = 18
ToggleBtn.AutoButtonColor = true

local ToggleCorner = Instance.new("UICorner")
ToggleCorner.CornerRadius = UDim.new(0, 12)
ToggleCorner.Parent = ToggleBtn

local ToggleStroke = Instance.new("UIStroke")
ToggleStroke.Color = Color3.fromRGB(80, 80, 80)
ToggleStroke.Thickness = 1.5
ToggleStroke.Parent = ToggleBtn

-- Main Menu Frame
local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.Parent = PandazGUI
MainFrame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.Size = UDim2.new(0.6, 0, 0.5, 0) -- Compact Mobile Size
MainFrame.Visible = false

local MainCorner = Instance.new("UICorner")
MainCorner.CornerRadius = UDim.new(0, 14)
MainCorner.Parent = MainFrame

local MainStroke = Instance.new("UIStroke")
MainStroke.Color = Color3.fromRGB(60, 60, 60)
MainStroke.Thickness = 1.5
MainStroke.Parent = MainFrame

-- Title
local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Parent = MainFrame
Title.BackgroundTransparency = 1
Title.Position = UDim2.new(0, 0, 0.05, 0)
Title.Size = UDim2.new(1, 0, 0.15, 0)
Title.Font = Enum.Font.GothamBold
Title.Text = "PandazWare Loader"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 18

-- Close Button
local CloseBtn = Instance.new("TextButton")
CloseBtn.Parent = MainFrame
CloseBtn.BackgroundTransparency = 1
CloseBtn.Position = UDim2.new(0.85, 0, 0.02, 0)
CloseBtn.Size = UDim2.new(0.12, 0, 0.12, 0)
CloseBtn.Font = Enum.Font.FredokaOne
CloseBtn.Text = "X"
CloseBtn.TextColor3 = Color3.fromRGB(220, 60, 60)
CloseBtn.TextSize = 18
CloseBtn.MouseButton1Click:Connect(function()
    MainFrame.Visible = false
    ToggleBtn.Visible = true
end)

-- Scroll Container
local ScrollContainer = Instance.new("ScrollingFrame")
ScrollContainer.Parent = MainFrame
ScrollContainer.BackgroundTransparency = 1
ScrollContainer.Position = UDim2.new(0.05, 0, 0.22, 0)
ScrollContainer.Size = UDim2.new(0.9, 0, 0.7, 0)
ScrollContainer.CanvasSize = UDim2.new(0, 0, 1.1, 0)
ScrollContainer.ScrollBarThickness = 2
ScrollContainer.ScrollBarImageColor3 = Color3.fromRGB(200, 200, 200)

local UIList = Instance.new("UIListLayout")
UIList.Parent = ScrollContainer
UIList.HorizontalAlignment = Enum.HorizontalAlignment.Center
UIList.SortOrder = Enum.SortOrder.LayoutOrder
UIList.Padding = UDim.new(0, 8)

-- Button Helper
local function CreateGameButton(text, callback)
    local BtnFrame = Instance.new("Frame")
    BtnFrame.Size = UDim2.new(0.98, 0, 0, 42)
    BtnFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
    BtnFrame.Parent = ScrollContainer
    
    local BtnCorner = Instance.new("UICorner")
    BtnCorner.CornerRadius = UDim.new(0, 8)
    BtnCorner.Parent = BtnFrame
    
    local BtnStroke = Instance.new("UIStroke")
    BtnStroke.Color = Color3.fromRGB(60, 60, 65)
    BtnStroke.Thickness = 1
    BtnStroke.Parent = BtnFrame
    
    local InteractBtn = Instance.new("TextButton")
    InteractBtn.Parent = BtnFrame
    InteractBtn.Size = UDim2.new(1, 0, 1, 0)
    InteractBtn.BackgroundTransparency = 1
    InteractBtn.Font = Enum.Font.GothamSemibold
    InteractBtn.Text = text
    InteractBtn.TextColor3 = Color3.fromRGB(240, 240, 240)
    InteractBtn.TextSize = 14
    
    InteractBtn.MouseButton1Click:Connect(function()
        NotificationLibrary.Notify("Loading", text .. "...", 2)
        if callback then callback() end
    end)
end

-- === MOBILE DRAG LOGIC === --
local dragging, dragInput, dragStart, startPos
local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end
MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then dragging = false end
        end)
    end
end)
MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if input == dragInput and dragging then update(input) end
end)
ToggleBtn.MouseButton1Click:Connect(function() MainFrame.Visible = not MainFrame.Visible end)

-- ========================================== --
--          3. GAME SCRIPTS (LOADSTRINGS)     --
-- ========================================== --

-- 1. Counter Blox (PandazWare NEW LINK)
CreateGameButton("Counter Blox", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/PandazWare/PandazWare/refs/heads/main/pandazware%202.txt"))()
    NotificationLibrary.Notify("Success", "Counter Blox injected!", 3)
end)

-- 2. Arsenal (Offenseware Mobile)
CreateGameButton("Arsenal", function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/Smokernosexyz/Offenseware-mobile-arsenal/refs/heads/main/Offenseware%20mobile%20script"))()
    NotificationLibrary.Notify("Success", "Offenseware injected!", 3)
end)

-- 3. Gunfight Arena (Integrated)
CreateGameButton("Gunfight Arena", function()
    NotificationLibrary.Notify("System", "Loading internal logic...", 2)
    
    -- Spawn function to keep loader responsive
    task.spawn(function()
        -- Gunfight Arena Logic Start
        local OrionLib = loadstring(game:HttpGet(('https://raw.githubusercontent.com/jensonhirst/Orion/main/source')))()
        local player = Players.LocalPlayer
        local camera = Workspace.CurrentCamera
        local rs = RunService

        local Window = OrionLib:MakeWindow({Name = "Gunfight Arena", HidePremium = false, SaveConfig = true, IntroEnabled = false})

        -- TAB: AIM
        local aimtab = Window:MakeTab({ Name = "Aim", Icon = "rbxassetid://4483345998", PremiumOnly = false })
        local aimsection = aimtab:AddSection({ Name = "Silent Aim" })
        local silentaim = false
        aimsection:AddToggle({
            Name = "Silent Aim",
            Default = false,
            Callback = function(Value) silentaim = Value end
        })

        -- TAB: WEAPONS
        local weapontab = Window:MakeTab({ Name = "Weapons", Icon = "rbxassetid://4483345998", PremiumOnly = false })
        local weapons = {}
        if game:GetService("ReplicatedStorage"):FindFirstChild("Weapons") then
            for _,v in pairs(game:GetService("ReplicatedStorage").Weapons:GetChildren()) do
                table.insert(weapons,v.Name)
            end
        else
            NotificationLibrary.Notify("Warning", "Weapons folder not found", 4)
        end

        local secondarySection = weapontab:AddSection({ Name = "Secondary Gun" })
        local selectedSecondary = nil
        
        if #weapons > 0 then
            secondarySection:AddDropdown({
                Name = "Select Gun",
                Default = weapons[1],
                Options = weapons,
                Callback = function(Value) selectedSecondary = Value end
            })
            secondarySection:AddButton({
                Name = "Equip (Reset Char)",
                Callback = function()
                    if selectedSecondary then
                        player:SetAttribute("Secondary", selectedSecondary)
                        NotificationLibrary.Notify("Done", "Now reset your character!", 3)
                    end
                end
            })
        end

        -- LOGIC: SILENT AIM
        local closestPlayer = nil
        local function getClosestPlayer()
            local team = player:GetAttribute("Team")
            local closest, distance = nil, math.huge
            for _, character in ipairs(Workspace:GetChildren()) do
                local humanoid = character:FindFirstChild("Humanoid")
                if character and humanoid and humanoid.Health > 0 then
                    local p = Players:FindFirstChild(character.Name)
                    if p and p:GetAttribute("Team") ~= team then
                        local head = character:FindFirstChild("Head")
                        if head then
                            local w2s, onscreen = camera:WorldToViewportPoint(head.Position)
                            if onscreen then
                                local dist = (Vector2.new(w2s.X, w2s.Y) - Vector2.new(camera.ViewportSize.X / 2, camera.ViewportSize.Y / 2)).Magnitude
                                if dist < distance then
                                    closest = character
                                    distance = dist
                                end
                            end
                        end
                    end
                end
            end
            return closest
        end

        rs.RenderStepped:Connect(function() closestPlayer = getClosestPlayer() end)
        
        local oldIndex
        oldIndex = hookmetamethod(game, "__index", function(self, index)
            if not checkcaller() then
                if self == camera and index == "CFrame" and silentaim and closestPlayer then
                   local head = closestPlayer:FindFirstChild("Head")
                   if head then return CFrame.new(camera.CFrame.Position, head.Position) end
                end
            end
            return oldIndex(self, index)
        end)

        OrionLib:Init()
        NotificationLibrary.Notify("Orion", "Gunfight GUI Loaded", 2)
    end)
end)

NotificationLibrary.Notify("Ready", "Tap PZ to open", 4)
