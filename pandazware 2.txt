-- // POKKAWARE -> PANDAZWARE UPDATE // --
-- Added: Chams (CBRO), Hit Chance (Univ57), Map Cleaner

getgenv().SecureMode = true

local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local Workspace = game:GetService("Workspace")
local Lighting = game:GetService("Lighting")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local Debris = Workspace:FindFirstChild("Debris")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera

local function getSafeParent()
    if gethui then return gethui() end
    if CoreGui then return CoreGui end
    return LocalPlayer:WaitForChild("PlayerGui")
end

-- Cleanup
for _, v in pairs(getSafeParent():GetChildren()) do
    if v.Name == "PandazWareUI" or v.Name == "DeltaNotifications" then v:Destroy() end
end

-- Notification Lib
local NotificationLibrary = {}
local NotifGui = Instance.new("ScreenGui")
NotifGui.Name = "DeltaNotifications"
NotifGui.Parent = getSafeParent()
NotifGui.DisplayOrder = 10000

local NotifContainer = Instance.new("Frame", NotifGui)
NotifContainer.Position = UDim2.new(0.5, -125, 0.05, 0)
NotifContainer.Size = UDim2.new(0, 250, 0.8, 0)
NotifContainer.BackgroundTransparency = 1

local NotifLayout = Instance.new("UIListLayout", NotifContainer)
NotifLayout.SortOrder = Enum.SortOrder.LayoutOrder
NotifLayout.Padding = UDim.new(0, 5)
NotifLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center

function NotificationLibrary.Notify(title, text, duration)
    local Frame = Instance.new("Frame", NotifContainer)
    Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
    Frame.Size = UDim2.new(1, 0, 0, 45)
    Frame.BackgroundTransparency = 0.1
    Instance.new("UICorner", Frame).CornerRadius = UDim.new(0, 6)
    
    local Stroke = Instance.new("UIStroke", Frame)
    Stroke.Color = Color3.fromRGB(120, 100, 255)
    Stroke.Thickness = 1
    
    local Title = Instance.new("TextLabel", Frame)
    Title.Text = title
    Title.Font = Enum.Font.GothamBold
    Title.TextColor3 = Color3.fromRGB(120, 100, 255)
    Title.TextSize = 13
    Title.Position = UDim2.new(0, 10, 0, 5)
    Title.Size = UDim2.new(1, -20, 0, 15)
    Title.BackgroundTransparency = 1
    Title.TextXAlignment = Enum.TextXAlignment.Left

    local Desc = Instance.new("TextLabel", Frame)
    Desc.Text = text
    Desc.Font = Enum.Font.Gotham
    Desc.TextColor3 = Color3.fromRGB(200, 200, 200)
    Desc.TextSize = 12
    Desc.Position = UDim2.new(0, 10, 0, 22)
    Desc.Size = UDim2.new(1, -20, 0, 15)
    Desc.BackgroundTransparency = 1
    Desc.TextXAlignment = Enum.TextXAlignment.Left

    task.delay(duration or 3, function() Frame:Destroy() end)
end

-- UI Library
local MiniUI = {}
local MainGUI = Instance.new("ScreenGui")
MainGUI.Name = "PandazWareUI"
MainGUI.Parent = getSafeParent()
MainGUI.IgnoreGuiInset = true
MainGUI.DisplayOrder = 9999

local Theme = {
    Bg = Color3.fromRGB(18, 18, 22),
    Sidebar = Color3.fromRGB(25, 25, 30),
    Element = Color3.fromRGB(35, 35, 40),
    Accent = Color3.fromRGB(120, 100, 255),
    Text = Color3.fromRGB(240, 240, 240)
}

function MiniUI:CreateWindow(title)
    local Window = {}
    local Main = Instance.new("Frame", MainGUI)
    Main.Size = UDim2.fromOffset(550, 320)
    Main.Position = UDim2.fromScale(0.5, 0.5)
    Main.AnchorPoint = Vector2.new(0.5, 0.5)
    Main.BackgroundColor3 = Theme.Bg
    Main.ClipsDescendants = true
    Instance.new("UICorner", Main).CornerRadius = UDim.new(0, 10)
    
    local dragging, dragStart, startPos
    Main.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true; dragStart = input.Position; startPos = Main.Position
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            Main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
    UserInputService.InputEnded:Connect(function(input) 
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then dragging = false end 
    end)

    local Sidebar = Instance.new("Frame", Main)
    Sidebar.Size = UDim2.new(0, 140, 1, 0)
    Sidebar.BackgroundColor3 = Theme.Sidebar
    
    local TitleLbl = Instance.new("TextLabel", Sidebar)
    TitleLbl.Text = title
    TitleLbl.Font = Enum.Font.FredokaOne
    TitleLbl.TextSize = 20
    TitleLbl.TextColor3 = Theme.Accent
    TitleLbl.Size = UDim2.new(1, 0, 0, 60)
    TitleLbl.BackgroundTransparency = 1
    
    local TabContainer = Instance.new("ScrollingFrame", Sidebar)
    TabContainer.Position = UDim2.new(0, 0, 0, 70)
    TabContainer.Size = UDim2.new(1, 0, 1, -70)
    TabContainer.BackgroundTransparency = 1
    TabContainer.ScrollBarThickness = 0
    local TabList = Instance.new("UIListLayout", TabContainer)
    TabList.Padding = UDim.new(0, 5)
    TabList.HorizontalAlignment = Enum.HorizontalAlignment.Center

    local Content = Instance.new("Frame", Main)
    Content.Position = UDim2.new(0, 150, 0, 10)
    Content.Size = UDim2.new(1, -160, 1, -20)
    Content.BackgroundTransparency = 1

    local ToggleBtn = Instance.new("TextButton", MainGUI)
    ToggleBtn.Size = UDim2.fromOffset(50, 50)
    ToggleBtn.Position = UDim2.new(0.05, 0, 0.15, 0)
    ToggleBtn.BackgroundColor3 = Theme.Sidebar
    ToggleBtn.Text = "PZ"
    ToggleBtn.Font = Enum.Font.FredokaOne
    ToggleBtn.TextSize = 22
    ToggleBtn.TextColor3 = Theme.Accent
    Instance.new("UICorner", ToggleBtn).CornerRadius = UDim.new(1, 0)
    Instance.new("UIStroke", ToggleBtn).Color = Theme.Accent
    Instance.new("UIStroke", ToggleBtn).Thickness = 2
    ToggleBtn.MouseButton1Click:Connect(function() Main.Visible = not Main.Visible end)
    
    local Tabs = {}
    function Window:CreateTab(name)
        local Tab = {}
        local Btn = Instance.new("TextButton", TabContainer)
        Btn.Size = UDim2.new(0.9, 0, 0, 35)
        Btn.BackgroundColor3 = Theme.Bg
        Btn.Text = name
        Btn.Font = Enum.Font.GothamMedium
        Btn.TextColor3 = Theme.Text
        Btn.TextSize = 14
        Instance.new("UICorner", Btn).CornerRadius = UDim.new(0, 6)
        
        local Page = Instance.new("ScrollingFrame", Content)
        Page.Size = UDim2.new(1, 0, 1, 0)
        Page.BackgroundTransparency = 1
        Page.Visible = false
        Page.ScrollBarThickness = 3
        Page.AutomaticCanvasSize = Enum.AutomaticSize.Y
        local PageLayout = Instance.new("UIListLayout", Page)
        PageLayout.Padding = UDim.new(0, 8)
        
        Btn.MouseButton1Click:Connect(function()
            for _, t in pairs(Tabs) do t.Page.Visible = false; t.Btn.TextColor3 = Theme.Text; t.Btn.BackgroundColor3 = Theme.Bg end
            Page.Visible = true; Btn.TextColor3 = Theme.Accent; Btn.BackgroundColor3 = Color3.fromRGB(35, 35, 40)
        end)
        table.insert(Tabs, {Btn = Btn, Page = Page})
        if #Tabs == 1 then Page.Visible = true; Btn.TextColor3 = Theme.Accent; Btn.BackgroundColor3 = Color3.fromRGB(35, 35, 40) end
        
        function Tab:Toggle(text, callback)
            local state = false
            local Widget = Instance.new("TextButton", Page)
            Widget.Size = UDim2.new(1, 0, 0, 40)
            Widget.BackgroundColor3 = Theme.Element
            Widget.Text = ""
            Widget.AutoButtonColor = false
            Instance.new("UICorner", Widget).CornerRadius = UDim.new(0, 6)
            local Label = Instance.new("TextLabel", Widget)
            Label.Text = text; Label.Size = UDim2.new(0.7, 0, 1, 0); Label.Position = UDim2.new(0, 10, 0, 0)
            Label.BackgroundTransparency = 1; Label.TextColor3 = Theme.Text; Label.Font = Enum.Font.Gotham; Label.TextSize = 13; Label.TextXAlignment = Enum.TextXAlignment.Left
            local Check = Instance.new("Frame", Widget)
            Check.Size = UDim2.new(0, 22, 0, 22); Check.Position = UDim2.new(1, -32, 0.5, -11)
            Check.BackgroundColor3 = Color3.fromRGB(50, 50, 55); Instance.new("UICorner", Check).CornerRadius = UDim.new(0, 4)
            local Status = Instance.new("Frame", Check)
            Status.Size = UDim2.new(0, 14, 0, 14); Status.AnchorPoint = Vector2.new(0.5, 0.5); Status.Position = UDim2.new(0.5, 0, 0.5, 0)
            Status.BackgroundColor3 = Theme.Accent; Status.BackgroundTransparency = 1; Instance.new("UICorner", Status).CornerRadius = UDim.new(0, 2)
            Widget.MouseButton1Click:Connect(function() state = not state; Status.BackgroundTransparency = state and 0 or 1; callback(state) end)
        end
        function Tab:Slider(text, min, max, default, callback)
            local val = default
            local Widget = Instance.new("Frame", Page)
            Widget.Size = UDim2.new(1, 0, 0, 55); Widget.BackgroundColor3 = Theme.Element; Instance.new("UICorner", Widget).CornerRadius = UDim.new(0, 6)
            local Label = Instance.new("TextLabel", Widget)
            Label.Text = text .. ": " .. val; Label.Size = UDim2.new(1, -20, 0, 20); Label.Position = UDim2.new(0, 10, 0, 5)
            Label.BackgroundTransparency = 1; Label.TextColor3 = Theme.Text; Label.Font = Enum.Font.Gotham; Label.TextSize = 13; Label.TextXAlignment = Enum.TextXAlignment.Left
            local BarBG = Instance.new("TextButton", Widget)
            BarBG.Size = UDim2.new(1, -20, 0, 6); BarBG.Position = UDim2.new(0, 10, 0, 35); BarBG.BackgroundColor3 = Color3.fromRGB(50, 50, 55); BarBG.Text = ""; BarBG.AutoButtonColor = false; Instance.new("UICorner", BarBG).CornerRadius = UDim.new(1, 0)
            local Fill = Instance.new("Frame", BarBG)
            Fill.Size = UDim2.new((val-min)/(max-min), 0, 1, 0); Fill.BackgroundColor3 = Theme.Accent; Instance.new("UICorner", Fill).CornerRadius = UDim.new(1, 0)
            local function Update(input)
                local pos = math.clamp((input.Position.X - BarBG.AbsolutePosition.X) / BarBG.AbsoluteSize.X, 0, 1)
                val = math.floor(min + ((max - min) * pos))
                Fill.Size = UDim2.new(pos, 0, 1, 0); Label.Text = text .. ": " .. val; callback(val)
            end
            local dragging = false
            BarBG.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.Touch or i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true; Update(i) end end)
            UserInputService.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.Touch or i.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end end)
            UserInputService.InputChanged:Connect(function(i) if dragging then Update(i) end end)
        end
        return Tab
    end
    return Window
end
-- // LOGIC PART // --

local Flags = {
    Aimbot = false, FOV = 100, Smooth = 0.5, WallCheck = true, HitChance = 100, -- HitChance hinzugefügt
    SilentAim = false, Hitbox = false, HitboxSize = 4, Spinbot = false, SpinSpeed = 50,
    ESP_Box = false, ESP_Skel = false, ESP_Trace = false, ESP_Chams = false, Fullbright = false, ClearMap = false, -- Chams & ClearMap
    NoRecoil = false, NoSpread = false, RapidFire = false, InfAmmo = false, InstaReload = false,
    TP = false, TPDist = 12, Speed = false, SpeedVal = 16, Bhop = false
}

local FOVCircle = Drawing.new("Circle")
FOVCircle.Color = Color3.fromRGB(120, 100, 255)
FOVCircle.Thickness = 1.5; FOVCircle.NumSides = 60; FOVCircle.Visible = false; FOVCircle.Filled = false

local SkeletonConnections = {
    {"Head", "UpperTorso"}, {"UpperTorso", "LowerTorso"}, {"Head", "Torso"},
    {"UpperTorso", "LeftUpperArm"}, {"LeftUpperArm", "LeftLowerArm"}, {"LeftLowerArm", "LeftHand"},
    {"UpperTorso", "RightUpperArm"}, {"RightUpperArm", "RightLowerArm"}, {"RightLowerArm", "RightHand"},
    {"Torso", "Left Arm"}, {"Torso", "Right Arm"},
    {"LowerTorso", "LeftUpperLeg"}, {"LeftUpperLeg", "LeftLowerLeg"}, {"LeftLowerLeg", "LeftFoot"},
    {"LowerTorso", "RightUpperLeg"}, {"RightUpperLeg", "RightLowerLeg"}, {"RightLowerLeg", "RightFoot"},
    {"Torso", "Left Leg"}, {"Torso", "Right Leg"}
}

local DrawCache = {Skeleton = {}, Tracers = {}, Chams = {}} -- Chams Cache

local function UpdateSkeleton(plr)
    if not DrawCache.Skeleton[plr] then DrawCache.Skeleton[plr] = {} end
    local cache = DrawCache.Skeleton[plr]
    
    if Flags.ESP_Skel and plr.Character and plr.Team ~= LocalPlayer.Team then
        local char = plr.Character
        for i, pair in pairs(SkeletonConnections) do
            local partA = char:FindFirstChild(pair[1])
            local partB = char:FindFirstChild(pair[2])
            
            if partA and partB then
                local line = cache[i]
                if not line then
                    line = Drawing.new("Line")
                    line.Thickness = 1.5; line.Color = Color3.fromRGB(255, 255, 255); line.Transparency = 1
                    cache[i] = line
                end
                
                local vecA, visA = Camera:WorldToViewportPoint(partA.Position)
                local vecB, visB = Camera:WorldToViewportPoint(partB.Position)
                
                if visA and visB then
                    line.Visible = true
                    line.From = Vector2.new(vecA.X, vecA.Y)
                    line.To = Vector2.new(vecB.X, vecB.Y)
                else
                    line.Visible = false
                end
            else
                if cache[i] then cache[i].Visible = false end
            end
        end
    else
        for _, line in pairs(cache) do line.Visible = false end
    end
end

-- Neuer Chams Function (CBRO Style Adornment)
local function UpdateChams(plr)
    if not plr.Character then return end
    
    -- Cleanup if disabled or teammate
    if not Flags.ESP_Chams or plr.Team == LocalPlayer.Team then
        if DrawCache.Chams[plr] then
            for _, v in pairs(DrawCache.Chams[plr]) do v:Destroy() end
            DrawCache.Chams[plr] = nil
        end
        return
    end

    if not DrawCache.Chams[plr] then DrawCache.Chams[plr] = {} end
    
    for _, part in pairs(plr.Character:GetChildren()) do
        if part:IsA("BasePart") and part.Name ~= "HumanoidRootPart" then
            if not DrawCache.Chams[plr][part] then
                -- Visible Cham
                local cham = Instance.new("BoxHandleAdornment")
                cham.Name = "PZ_Cham"
                cham.Adornee = part
                cham.Parent = part
                cham.Size = part.Size
                cham.Color3 = Color3.fromRGB(255, 0, 0) -- Rot für Feinde
                cham.AlwaysOnTop = true
                cham.ZIndex = 5
                cham.Transparency = 0.5
                DrawCache.Chams[plr][part] = cham
            end
        end
    end
end

local function UpdateTracers(plr)
    if not DrawCache.Tracers[plr] then 
        local t = Drawing.new("Line")
        t.Thickness = 1; t.Color = Color3.fromRGB(120, 100, 255)
        DrawCache.Tracers[plr] = t
    end
    local line = DrawCache.Tracers[plr]
    
    if Flags.ESP_Trace and plr.Character and plr.Team ~= LocalPlayer.Team and plr.Character:FindFirstChild("HumanoidRootPart") then
        local root = plr.Character.HumanoidRootPart
        local vec, vis = Camera:WorldToViewportPoint(root.Position)
        if vis then
            line.Visible = true
            line.From = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y)
            line.To = Vector2.new(vec.X, vec.Y)
        else
            line.Visible = false
        end
    else
        line.Visible = false
    end
end

local function GetTarget()
    local closest, maxDist = nil, Flags.FOV
    local center = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Team ~= LocalPlayer.Team and p.Character and p.Character:FindFirstChild("Head") and p.Character.Humanoid.Health > 0 then
            
            -- HIT CHANCE LOGIC (Univ57 Feature)
            local targetPart = p.Character.Head
            if math.random(1, 100) > Flags.HitChance then
                -- Wenn HitChance fehlschlägt, ziele auf den Torso oder random daneben (Body Aim)
                targetPart = p.Character:FindFirstChild("UpperTorso") or p.Character:FindFirstChild("Torso") or p.Character.Head
            end

            local pos, vis = Camera:WorldToViewportPoint(targetPart.Position)
            if vis then
                local dist = (Vector2.new(pos.X, pos.Y) - center).Magnitude
                if dist < maxDist then
                    local isVisible = true
                    if Flags.WallCheck then
                        local ray = Ray.new(Camera.CFrame.Position, (targetPart.Position - Camera.CFrame.Position).Unit * 500)
                        local hit = Workspace:FindPartOnRayWithIgnoreList(ray, {LocalPlayer.Character, Camera})
                        if hit and not hit:IsDescendantOf(p.Character) then isVisible = false end
                    end
                    if isVisible then closest = targetPart; maxDist = dist end
                end
            end
        end
    end
    return closest
end

local function ApplyGunMods()
    local W = ReplicatedStorage:WaitForChild("Weapons")
    for _, w in ipairs(W:GetChildren()) do
        if Flags.RapidFire and w:FindFirstChild("FireRate") then w.FireRate.Value = 0 end
        if Flags.NoSpread then
             local s = w:FindFirstChild("Spread")
             if s then
                if s:IsA("ValueBase") then s.Value = 0 end
                for _, c in ipairs(s:GetChildren()) do if c:IsA("NumberValue") then c.Value = 0 end end
             end
        end
        if Flags.NoRecoil then
             local r = w:FindFirstChild("Recoil")
             if r then for _, c in ipairs(r:GetChildren()) do if c:IsA("NumberValue") then c.Value = 0 end end end
        end
        if Flags.InfAmmo and w:FindFirstChild("Ammo") then w.Ammo.Value = 999 end
        if Flags.InfAmmo and w:FindFirstChild("StoredAmmo") then w.StoredAmmo.Value = 9999 end
        if Flags.InstaReload and w:FindFirstChild("ReloadTime") then w.ReloadTime.Value = 0.05 end
    end
end
local Window = MiniUI:CreateWindow("PandazWare")

local Legit = Window:CreateTab("Legit")
Legit:Toggle("Aimbot", function(v) Flags.Aimbot = v end)
Legit:Slider("FOV Radius", 10, 400, 100, function(v) Flags.FOV = v end)
Legit:Slider("Smoothness", 0, 10, 5, function(v) Flags.Smooth = v/10 end)
Legit:Slider("Hit Chance %", 0, 100, 100, function(v) Flags.HitChance = v end) -- Neu
Legit:Toggle("Wall Check", function(v) Flags.WallCheck = v end)
Legit:Toggle("Show FOV", function(v) Flags.ShowFOV = v end)

local Rage = Window:CreateTab("Rage")
Rage:Toggle("Silent Aim", function(v) Flags.SilentAim = v end)
Rage:Toggle("Hitbox Extender", function(v) Flags.Hitbox = v end)
Rage:Slider("Hitbox Size", 2, 15, 4, function(v) Flags.HitboxSize = v end)
Rage:Toggle("Spinbot", function(v) Flags.Spinbot = v end)
Rage:Slider("Spin Speed", 10, 100, 50, function(v) Flags.SpinSpeed = v end)

local Visuals = Window:CreateTab("Visuals")
Visuals:Toggle("Chams (Wallhack)", function(v) Flags.ESP_Chams = v end) -- Neu
Visuals:Toggle("Box ESP", function(v) Flags.ESP_Box = v end)
Visuals:Toggle("Skeleton ESP", function(v) Flags.ESP_Skel = v end)
Visuals:Toggle("Tracers", function(v) Flags.ESP_Trace = v end)
Visuals:Toggle("Fullbright", function(v) Flags.Fullbright = v end)
Visuals:Toggle("Clear Map (No Fog/Debris)", function(v) Flags.ClearMap = v end) -- Neu

local Gun = Window:CreateTab("Gun Mods")
Gun:Toggle("No Recoil", function(v) Flags.NoRecoil = v end)
Gun:Toggle("No Spread", function(v) Flags.NoSpread = v end)
Gun:Toggle("Rapid Fire", function(v) Flags.RapidFire = v end)
Gun:Toggle("Infinite Ammo", function(v) Flags.InfAmmo = v end)
Gun:Toggle("Instant Reload", function(v) Flags.InstaReload = v end)

local Misc = Window:CreateTab("Misc")
Misc:Toggle("3rd Person", function(v) Flags.TP = v end)
Misc:Slider("TP Distance", 5, 30, 12, function(v) Flags.TPDist = v end)
Misc:Toggle("Speed Hack", function(v) Flags.Speed = v end)
Misc:Slider("Speed Value", 16, 100, 25, function(v) Flags.SpeedVal = v end)
Misc:Toggle("Auto Bhop", function(v) Flags.Bhop = v end)

RunService.RenderStepped:Connect(function()
    FOVCircle.Position = Vector2.new(Camera.ViewportSize.X/2, Camera.ViewportSize.Y/2)
    FOVCircle.Radius = Flags.FOV
    FOVCircle.Visible = Flags.ShowFOV

    if Flags.Aimbot and not Flags.SilentAim then
        local t = GetTarget()
        if t then
            local cf = CFrame.new(Camera.CFrame.Position, t.Position)
            Camera.CFrame = Camera.CFrame:Lerp(cf, 1 - Flags.Smooth)
        end
    elseif Flags.SilentAim then
        local t = GetTarget()
        if t then Camera.CFrame = CFrame.new(Camera.CFrame.Position, t.Position) end
    end

    if Flags.Spinbot and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        local root = LocalPlayer.Character.HumanoidRootPart
        root.CFrame = root.CFrame * CFrame.Angles(0, math.rad(Flags.SpinSpeed), 0)
    end
    
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then
            UpdateSkeleton(p)
            UpdateTracers(p)
            UpdateChams(p) -- Chams Loop
        end
    end
end)

local AdornmentCache = {}
task.spawn(function()
    while true do
        task.wait(0.1)
        
        if Flags.NoRecoil or Flags.NoSpread or Flags.RapidFire or Flags.InfAmmo or Flags.InstaReload then
            ApplyGunMods()
        end
        
        -- Clear Map Logic (CBRO Feature)
        if Flags.ClearMap then
             if Debris then Debris:ClearAllChildren() end -- Entfernt Granatenrauch etc.
             Lighting.FogEnd = 999999 -- Entfernt Nebel
        end

        if Flags.ESP_Box then
            for _, p in pairs(Players:GetPlayers()) do
                if p ~= LocalPlayer and p.Team ~= LocalPlayer.Team and p.Character then
                    if not AdornmentCache[p] then
                        local b = Instance.new("BoxHandleAdornment", p.Character)
                        b.Adornee = p.Character:FindFirstChild("HumanoidRootPart")
                        b.Size = Vector3.new(4,5,1)
                        b.AlwaysOnTop = true
                        b.Transparency = 0.5
                        b.Color3 = Color3.fromRGB(120, 100, 255)
                        AdornmentCache[p] = b
                    end
                end
            end
        else
            for i,v in pairs(AdornmentCache) do v:Destroy() end
            AdornmentCache = {}
        end

        if Flags.Hitbox then
            for _, p in pairs(Players:GetPlayers()) do
                if p ~= LocalPlayer and p.Team ~= LocalPlayer.Team and p.Character and p.Character:FindFirstChild("HumanoidRootPart") then
                    local root = p.Character.HumanoidRootPart
                    root.Size = Vector3.new(Flags.HitboxSize, Flags.HitboxSize, Flags.HitboxSize)
                    root.Transparency = 0.7
                    root.CanCollide = false
                    root.Material = Enum.Material.Neon
                    root.Color = Color3.fromRGB(255, 0, 0)
                end
            end
        end
        
        if Flags.Fullbright then Lighting.Brightness = 2; Lighting.ClockTime = 14 else Lighting.Brightness = 1 end
        
        if Flags.Speed and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
            LocalPlayer.Character.Humanoid.WalkSpeed = Flags.SpeedVal
        end
        
        if Flags.Bhop and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
             if LocalPlayer.Character.Humanoid.MoveDirection.Magnitude > 0 and LocalPlayer.Character.Humanoid.FloorMaterial ~= Enum.Material.Air then
                 LocalPlayer.Character.Humanoid.Jump = true
             end
        end
        
        if Flags.TP then
            LocalPlayer.CameraMode = Enum.CameraMode.Classic
            LocalPlayer.CameraMaxZoomDistance = Flags.TPDist
            LocalPlayer.CameraMinZoomDistance = Flags.TPDist
        else
            LocalPlayer.CameraMode = Enum.CameraMode.LockFirstPerson
            LocalPlayer.CameraMaxZoomDistance = 0.5
        end
    end
end)

NotificationLibrary.Notify("PandazWare", "All Features Integrated!", 3)
