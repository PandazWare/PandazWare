--[[
    PandazWare Arsenal Optimized for Delta
    Zusammengestellt aus:
    - [span_0](start_span)[span_1](start_span)PandazWare UI Library[span_0](end_span)[span_1](end_span)
    - [span_2](start_span)[span_3](start_span)Hitbox Expander [cite: 341-343]
    - [cite_start]Arsenal v5.3 Gun Mods (Recoil, RapidFire)[span_2](end_span)[span_3](end_span)
    - [span_4](start_span)Infinite Ammo GUI Logic[span_4](end_span)
    - [span_5](start_span)[span_6](start_span)Highlights ESP [cite: 249-253]
]]

-- 1. Services & CleanUp
local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Camera = Workspace.CurrentCamera
local LocalPlayer = Players.LocalPlayer

-- CleanUp alter Instanzen bei Re-Execution
if getgenv().ArsenalCleanup then getgenv().ArsenalCleanup() end

-- 2. Globale Settings (getgenv für Delta Support)
getgenv().Settings = {
    Aimbot = false,
    AimbotFOV = 150,
    AimbotSmooth = 10,
    TeamCheck = true,
    SilentAim = false, -- Hitbox Expander als "Silent Aim" Ersatz für Mobile
    HitboxSize = 2,
    ESP = false,
    ESP_TeamCheck = true,
    InfiniteAmmo = false,
    RapidFire = false,
    NoRecoil = false,
    RainbowGun = false,
    WalkSpeed = 16,
    JumpPower = 50,
    InfJump = false
}

-- 3. Funktionen & Logik

-- [Aimbot Logik]
local function GetClosestPlayer()
    local closest = nil
    local shortestDist = getgenv().Settings.AimbotFOV
    local mousePos = UserInputService:GetMouseLocation()

    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("Head") and plr.Character:FindFirstChild("Humanoid") and plr.Character.Humanoid.Health > 0 then
            [cite_start]-- Team Check[span_5](end_span)[span_6](end_span)
            if getgenv().Settings.TeamCheck and plr.Team == LocalPlayer.Team then continue end

            local pos, onScreen = Camera:WorldToViewportPoint(plr.Character.Head.Position)
            if onScreen then
                local dist = (Vector2.new(pos.X, pos.Y) - mousePos).Magnitude
                if dist < shortestDist then
                    shortestDist = dist
                    closest = plr.Character.Head
                end
            end
        end
    end
    return closest
end

-[span_7](start_span)- [Highlight ESP Logik - Optimiert für Mobile][span_7](end_span)
local Highlights = {}
local function UpdateESP()
    if not getgenv().Settings.ESP then
        for i, hl in pairs(Highlights) do hl:Destroy() Highlights[i] = nil end
        return
    end

    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character then
            if not Highlights[plr] then
                local hl = Instance.new("Highlight")
                hl.Name = "PandazESP"
                hl.FillColor = Color3.fromRGB(255, 0, 0)
                hl.OutlineColor = Color3.fromRGB(255, 255, 255)
                hl.FillTransparency = 0.5
                hl.OutlineTransparency = 0
                hl.Parent = plr.Character
                Highlights[plr] = hl
            else
                if Highlights[plr].Parent ~= plr.Character then
                    Highlights[plr].Parent = plr.Character
                end
            end

            -- Team Check Visuals
            local isTeammate = (plr.Team == LocalPlayer.Team)
            if getgenv().Settings.ESP_TeamCheck and isTeammate then
                Highlights[plr].Enabled = false
            else
                Highlights[plr].Enabled = true
                Highlights[plr].FillColor = isTeammate and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
            end
        elseif Highlights[plr] then
            Highlights[plr]:Destroy()
            Highlights[plr] = nil
        end
    end
end

-[span_8](start_span)- [Hitbox Expander Logik][span_8](end_span)
local function UpdateHitbox()
    if not getgenv().Settings.SilentAim then return end -- SilentAim hier als Hitbox Expander Trigger
    for _, plr in pairs(Players:GetPlayers()) do
        if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
            if getgenv().Settings.TeamCheck and plr.Team == LocalPlayer.Team then continue end
            
            local hrp = plr.Character.HumanoidRootPart
            hrp.Size = Vector3.new(getgenv().Settings.HitboxSize, getgenv().Settings.HitboxSize, getgenv().Settings.HitboxSize)
            hrp.Transparency = 0.7
            hrp.CanCollide = false
            hrp.Material = Enum.Material.Neon
        end
    end
end

-[span_9](start_span)[span_10](start_span)[span_11](start_span)- [Gun Mods Loop][span_9](end_span)[span_10](end_span)[span_11](end_span)
local function GunModsLoop()
    -- Infinite Ammo (GUI Method - Safe für Mobile)
    if getgenv().Settings.InfiniteAmmo then
        pcall(function()
            LocalPlayer.PlayerGui.GUI.Client.Variables.ammocount.Value = 999
            LocalPlayer.PlayerGui.GUI.Client.Variables.ammocount2.Value = 999
        end)
    end

    -- Recoil & Rapid Fire (GC Scan - Kann auf manchen Executoren crashen, daher pcall)
    if getgenv().Settings.NoRecoil or getgenv().Settings.RapidFire then
        pcall(function()
            for _, v in pairs(getgc(true)) do
                if type(v) == "table" then
                    if getgenv().Settings.NoRecoil then
                        if rawget(v, "Recoil") then v.Recoil = 0 end
                        if rawget(v, "spread") then v.spread = 0 end
                    end
                    if getgenv().Settings.RapidFire then
                        if rawget(v, "FireRate") then v.FireRate = 0.02 end
                    end
                end
            end
        end)
    end
end

-[span_12](start_span)- [Rainbow Gun][span_12](end_span)
local hue = 0
local function RainbowGunLoop()
    if not getgenv().Settings.RainbowGun then return end
    hue = hue + 0.01
    if hue > 1 then hue = 0 end
    
    if Camera:FindFirstChild("Arms") then
        for _, v in pairs(Camera.Arms:GetDescendants()) do
            if v:IsA("MeshPart") then
                v.Color = Color3.fromHSV(hue, 1, 1)
            end
        end
    end
end

-- 4. Main Loops starten
local Loops = {}
table.insert(Loops, RunService.RenderStepped:Connect(function()
    UpdateESP()
    UpdateHitbox()
    RainbowGunLoop()
    
    -- Aimbot Execution
    if getgenv().Settings.Aimbot then
        local target = GetClosestPlayer()
        if target then
            local desired = CFrame.new(Camera.CFrame.Position, target.Position)
            Camera.CFrame = Camera.CFrame:Lerp(desired, getgenv().Settings.AimbotSmooth / 100)
        end
    end
end))

table.insert(Loops, RunService.Stepped:Connect(function()
    GunModsLoop()
end))

-- Inf Jump Connection
table.insert(Loops, UserInputService.JumpRequest:Connect(function()
    if getgenv().Settings.InfJump and LocalPlayer.Character then
        LocalPlayer.Character:FindFirstChildOfClass("Humanoid"):ChangeState("Jumping")
    end
end))

-[span_13](start_span)- Walkspeed Loop[span_13](end_span)
table.insert(Loops, RunService.RenderStepped:Connect(function()
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        if LocalPlayer.Character.Humanoid.WalkSpeed ~= getgenv().Settings.WalkSpeed then
            LocalPlayer.Character.Humanoid.WalkSpeed = getgenv().Settings.WalkSpeed
        end
    end
end))

-- Cleanup Function definieren
getgenv().ArsenalCleanup = function()
    for _, conn in pairs(Loops) do conn:Disconnect() end
    for _, hl in pairs(Highlights) do hl:Destroy() end
    getgenv().ArsenalCleanup = nil
end
-[span_14](start_span)[span_15](start_span)- 5. UI Library Laden & Konfigurieren[span_14](end_span)[span_15](end_span)
-- Nutzt die vom User bereitgestellte Library URL
local PandazWare = loadstring(game:HttpGet("https://raw.githubusercontent.com/PandazWare/PandazWare/refs/heads/main/PandazWare%20libary"))()

-[span_16](start_span)- Fenster erstellen[span_16](end_span)
local Window = PandazWare:CreateWindow({
    Title = "PandazWare | Arsenal | Delta",
    Size = UDim2.new(0, 500, 0, 350) -- Optimierte Größe
})

-- == Combat Tab ==
local CombatTab = Window:CreateTab("Combat")

CombatTab:Toggle("Aimbot Active", false, function(state)
    getgenv().Settings.Aimbot = state
end)

CombatTab:Slider("Aimbot FOV", 50, 500, 150, function(value)
    getgenv().Settings.AimbotFOV = value
end)

CombatTab:Slider("Smoothness", 1, 50, 10, function(value)
    getgenv().Settings.AimbotSmooth = value
end)

CombatTab:Toggle("Team Check", true, function(state)
    getgenv().Settings.TeamCheck = state
end)

CombatTab:Toggle("Hitbox Expander (Silent)", false, function(state)
    getgenv().Settings.SilentAim = state
    if not state then
        -- Reset Hitbox Größe beim Ausschalten
        for _, plr in pairs(Players:GetPlayers()) do
            if plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
                plr.Character.HumanoidRootPart.Size = Vector3.new(2, 2, 1)
                plr.Character.HumanoidRootPart.Transparency = 1
            end
        end
    end
end)

CombatTab:Slider("Hitbox Size", 2, 20, 2, function(value)
    getgenv().Settings.HitboxSize = value
end)

-[span_17](start_span)[span_18](start_span)[span_19](start_span)- == Weapon Tab ==[span_17](end_span)[span_18](end_span)[span_19](end_span)
local WeaponTab = Window:CreateTab("Weapon")

WeaponTab:Toggle("Infinite Ammo", false, function(state)
    getgenv().Settings.InfiniteAmmo = state
end)

WeaponTab:Toggle("Rapid Fire", false, function(state)
    getgenv().Settings.RapidFire = state
    if state then 
        PandazWare:Notify("Warning", "Rapid Fire can be risky!", 3) 
    end
end)

WeaponTab:Toggle("No Recoil", false, function(state)
    getgenv().Settings.NoRecoil = state
end)

WeaponTab:Toggle("Rainbow Gun", false, function(state)
    getgenv().Settings.RainbowGun = state
end)

-[span_20](start_span)- == Visuals Tab ==[span_20](end_span)
local VisualTab = Window:CreateTab("Visuals")

VisualTab:Toggle("ESP Active (Highlights)", false, function(state)
    getgenv().Settings.ESP = state
    if not state then UpdateESP() end -- Clean visuals immediatley
end)

VisualTab:Toggle("ESP Team Check", true, function(state)
    getgenv().Settings.ESP_TeamCheck = state
end)

-[span_21](start_span)[span_22](start_span)- == Player Tab ==[span_21](end_span)[span_22](end_span)
local PlayerTab = Window:CreateTab("Player")

PlayerTab:Toggle("Infinite Jump", false, function(state)
    getgenv().Settings.InfJump = state
end)

PlayerTab:Slider("WalkSpeed", 16, 150, 16, function(value)
    getgenv().Settings.WalkSpeed = value
end)

PlayerTab:Button("Force Reset Character", function()
    if LocalPlayer.Character then LocalPlayer.Character:BreakJoints() end
end)

-[span_23](start_span)- Notification[span_23](end_span)
PandazWare:Notify("Success", "PandazWare loaded for Delta!", 5)
